<main>
  <div class="col_md-10">
    <div clas="row">
      <div class="col-md-12">
        <h1>Viking Store Analytics Dashboard</h1>
      </div>
    </div>
    <div class="row">
      <div class="col-md-5 panel">
        <h2>1. Overall Platform</h2>
        <% @time_frames.each do |time_frames| %>
          <div class="row">
            <div class="col-md-12">
              <h3>
                <%= time_frame ? "Last #{time_frame} Days" : "Total" %>
              </h3>
                <%= render partial: "overall",
                      locals: { users: @new_users[time_frame],
                                orders: @new_orders[time_frame],
                                products: @new_products[time_frame],
                                revenue: @revenue[time_frame]} %>
            </div>
          </div>
        <% end %>
      </div>
      <div class="col-md-5 col-md-offset-1 panel">
        <h2>2. User Demographics and Behavior</h2>
        <div class="row">
          <div class="col-md-12">
            <h3>Top 3 States Users Live In (billing)</h3>
            <table class="table table-striped table-bordered">
              <thead>
                <tr>
                  <th>
                    Item
                  </th>
                  <th>
                    Data
                  </th>
                </tr>
              </thead>
              <tbody>
                <%= @top_states.each do |entry| %>
                  <tr>
                    <td>
                      <%= entry.state_name %>
                    </td>
                    <td>
                      <%= entry.users_in_state %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <h3>Top 3 Cities Users Live In (billing)</h3>
            <table class="table table-striped table-bordered">
              <thead>
                <tr>
                  <th>
                    Item
                  </th>
                  <th>
                    Data
                  </th>
                </tr>
              </thead>
              <tbody>
                <% @top_cities.each do |entry| %>
                  <tr>
                    <td>
                      <%= entry.city_name %>
                    </td>
                    <td>
                      <%= entry.users_in_city %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <h3>Top Users With...</h3>
            <table class="table table-striped table-bordered">
              <thead>
                <tr>
                  <th>
                    Critera
                  </th>
                  <th>
                    Customer Name
                  </th>
                  <th>
                    Quantity
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    Highest Single Order Value
                  </td>
                  <td>
                    <%= Order.highest_single_order(0,0) + " "+ Order.highest_single_order(0,1) %>
                  </td>
                  <td>
                    <%= format("$%.0f",Order.highest_single_order(0,2)) %>
                  </td>
                </tr>
                <tr>
                  <td>
                    Highest Lifetime Value
                  </td>
                  <td>
                    <%= Order.hightest_life_value(0,0) + " " +
                        Order.hightest_life_value(0, 1) %>
                  </td>
                  <td>
                    <%= format("$%.0f",Order.hightest_life_value(0,2)) %>
                  </td>
                </tr>
                <tr>
                  <td>
                    Highest Average Order Value
                  </td>
                  <td>
                    <%= Order.highest_average_order(0,0) + " " +
                        Order.highest_average_order(0,1) %>
                  </td>
                  <td>
                    <%= format("$%.0f",Order.highest_average_order(0,2)) %>
                  </td>
                </tr>
                <tr>
                  <td>
                    Most Orders Placed
                  </td>
                  <td>
                    <%= Order.most_orders_places(0,0) + " " +
                        Order.most_orders_places(0,1) %>
                  </td>
                  <td>
                    <%= Order.most_orders_places(0,2) %>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-5">
        <h2>3. Order Statistics</h2>
        <% @time_frame.each do |time_frame| %>
          <div class="row">
            <div class="col-md-12">
              <h3>
                <%= time_frame ? "Last #{time_frame} Days" : "Total" %>
              </h3>
              <%= render partial: "statistics",
                          locals: {new_orders: @new_orders[time_frame],
                                  revenue: @revenue[time_frame],
                                  largest_order: @largest_order[time_frame]} %>
            </div>
          </div>
        <% end %>
      <div class="col-md-r col-md-offset-1 panel">
        <h2>4. Time Series Data</h2>
        <div class="row">
          <div class="col-md-12">
            <h3>Orders by day</h3>
            <table class="table table-striped table-bordered">
              <thead>
                <tr>
                  <th>
                    Date
                  </th>
                  <th>
                    Quantity
                  </th>
                  <th>
                    Value
                  </th>
                </tr>
              </thead>
              <tbody>
                <% @order_days.each_with_index do |entry, index| %>
                  <tr>
                    <td>
                      <%(Time.now - index.day).strftime("%m/%d") %>
                    </td>
                    <td>
                      <%= entry %>
                    </td>
                    <td>
                      <%= number_to_currency(@daily_revenue[index])%>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <h3>Orders by Week</h3>
            <table class="table table-striped table-bordered">
              <thead>
                <tr>
                  <th>
                    Week Of
                  </th>
                  <th>
                    Quantity
                  </th>
                </tr>
                <th>
                  Value
                </th>
              </thead>
              <tbody>
                <% @order_weeks.each_with_index do |entry, index| %>
                  <tr>
                    <td>
                      <%= (Time.now.midnight - Time.now.wday - (7 * index).day).strftime("%m/%d") %>
                    </td>
                    <td>
                      <%= entry %>
                    </td>
                    <td>
                      <%= number_to_currency(@weekly_revenue[index]) %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>
